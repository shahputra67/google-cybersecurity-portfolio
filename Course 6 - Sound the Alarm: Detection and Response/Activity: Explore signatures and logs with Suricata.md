# Activity Overview

In this activity, you will explore Suricata alerts and logs, including rule creation and testing.

Suricata monitors network interfaces and applies rules to packets. Rules determine whether packets trigger alerts, are dropped, rejected, or allowed. You will examine custom rules, trigger alerts, and analyze log outputs in `fast.log` and `eve.json`.

You will use the supplied `sample.pcap` and `custom.rules` files to test your Suricata rules.

## Scenario

You are a security analyst monitoring your employer's network. Your tasks:

1. Explore custom rules in Suricata.
2. Run Suricata with a custom rule to trigger alerts.
3. Examine `fast.log` and `eve.json` outputs.

## Files used:

- `sample.pcap` – Packet capture with example network traffic.
- `custom.rules` – Custom Suricata rules.
- `fast.log` – Alerts generated by Suricata (quick check).
- `eve.json` – Main Suricata log in JSON format (detailed analysis).

**Note:** Lab starts with your user `analyst` already logged in to Bash.

---

## Task 1: Examine a custom rule in Suricata

## Display the custom rule:

bash
cat custom.rules

## Example rule:

alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"GET on wire"; flow:established,to_server; content:"GET"; http_method; sid:12345; rev:3;)

## Components:

Action – alert triggers an alert on matching traffic.

Header – Defines protocol (http), source/destination ($HOME_NET any -> $EXTERNAL_NET any), and traffic direction.

## Rule options – Parameters in parentheses:

msg:"GET on wire" – Alert text.

flow:established,to_server – Matches client-to-server traffic.

content:"GET" – Looks for GET method.

sid:12345 – Signature ID.

rev:3 – Revision version.

## Task 2: Trigger a custom rule in Suricata

## 1. List log files:

ls -l /var/log/suricata

## 2. Run Suricata:

sudo suricata -r sample.pcap -S custom.rules -k none

-r sample.pcap – Input traffic file.

-S custom.rules – Rule file.

-k none – Disable checksum validation.

## 3. List log files again:

ls -l /var/log/suricata

## 4. Examine alerts:

cat /var/log/suricata/fast.log

Example output:

11/23/2022-12:38:34.624866  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:49652 -> 142.250.1.139:80
11/23/2022-12:38:58.958203  [**] [1:12345:3] GET on wire [**] [Classification: (null)] [Priority: 3] {TCP} 172.21.224.2:58494 -> 142.250.1.139:80

##Task 3: Examine eve.json output

## 1. Display eve.json:

cat /var/log/suricata/eve.json

## 2. Use jq for formatted output:

jq . /var/log/suricata/eve.json | less

jq formats JSON for readability.

Use f and b to scroll; press Q to exit.

## 3. First alert severity: 3

Extract specific fields: jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json

Example output: ["2022-11-23T12:38:34.624866+0000",14500150016149,"GET on wire","TCP","142.250.1.139"]
["2022-11-23T12:38:58.958203+0000",1647223379236084,"GET on wire","TCP","142.250.1.102"]

Destination IP of last event: 142.250.1.102

First alert signature: GET on wire

Filter logs by flow_id:

jq "select(.flow_id==X)" /var/log/suricata/eve.json

Replace X with a specific flow_id.

flow_id identifies packets in the same network flow.

## Conclusion

You have learned to:

Create and run custom Suricata rules.

Monitor traffic from packet captures.

Examine alerts in fast.log and eve.json.

These skills help you analyze network traffic and detect threats effectively.
